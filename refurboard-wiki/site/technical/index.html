<!DOCTYPE html>
<html>

<head>

    <title>Technical Guide - Refurboard</title>
    <style>
      /* load heading font */
      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400');
      @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@400');
      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700');
      @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@700');

      /* load body font */
      @import url('https://fonts.googleapis.com/css2?family=Noto Sans:wght@400');
      @import url('https://fonts.googleapis.com/css2?family=Noto Sans:ital,wght@400');
      @import url('https://fonts.googleapis.com/css2?family=Noto Sans:wght@700');
      @import url('https://fonts.googleapis.com/css2?family=Noto Sans:ital,wght@700');

      /* load mono font */
      @import url('https://fonts.googleapis.com/css2?family=JetBrains Mono:wght@400');
      @import url('https://fonts.googleapis.com/css2?family=JetBrains Mono:ital,wght@400');
      @import url('https://fonts.googleapis.com/css2?family=JetBrains Mono:wght@700');
      @import url('https://fonts.googleapis.com/css2?family=JetBrains Mono:ital,wght@700');

      /* load emoji font */
      @font-face {
        font-family: "Noto Color Emoji";
        src: url('../assets/fonts/emoji/NotoColorEmoji-Regular.ttf');
        font-weight: 400;
      }
  
      :root {
        /* colors */
        --primary: #05b2dc;
        --secondary: #ef9B0f;
        --tertiary: #ef3e36;
        /* shades */
        --base: #ffffff;
        --mantle: #f5f4f5;
        --crust: #d4d2d5;
        --overlay: #aBaBaE;
        --footer: #000000cc;
        /* text */
        --text: #343233;
        --hltext: #ffffff;
        color: var(--text);
        /* background-specific text */
        --primary-text: var(--hltext);
        --secondary-text: var(--hltext);
        --tertiary-text: var(--hltext);
        --base-text: var(--text);
        --mantle-text: var(--text);
        --crust-text: var(--text);
        --overlay-text: var(--hltext);
        --footer-text: var(--hltext);
        /* fonts */
        --heading: Poppins, Noto Color Emoji;
        --body: Noto Sans, Noto Color Emoji;
        --mono: JetBrains Mono, Noto Color Emoji;
        font-family: var(--body); 
      }
      /* dark mode */
      @media (prefers-color-scheme: dark) {
        :root {
          /* colors */
          --primary: #05b2dc;
          --secondary: #ef9B0f;
          --tertiary: #ef3e36;
          /* shades */
          --base: #343233;
          --mantle: #373536;
          --crust: #3E3C3D;
          --overlay: #646461;
          --footer: #00000022;
          /* text */
          --text: #ffffff;
          --hltext: #343233;
          color: var(--text);
          /* background-specific text */
          --primary-text: var(--text);
          --secondary-text: var(--text);
          --tertiary-text: var(--text);
          --base-text: var(--text);
          --mantle-text: var(--text);
          --crust-text: var(--text);
          --overlay-text: var(--hltext);
          --footer-text: var(--text);
        }
      }
      /* style settings */
      header#header {
        grid-template-columns: 8rem auto 8rem;
      }
      body#background {
        background: fixed center/cover var(--base);
        
        
      }
      #background-gradient {
        background: linear-gradient(
          45deg, 
          color-mix(in srgb, var(--mantle) 80%, transparent), transparent, color-mix(in srgb, var(--crust) 20%, transparent)
        );
      }
      content#content {
        padding: 0 3rem;
        background: color-mix(in srgb, var(--base) 0%, transparent);
        border-left: none;
        border-right: none;
      }
      #avatar {
        
        border-radius: 1rem;
        
      }
      footer#footer a {
        color: #ef9B0f;
      }
      footer#footer a:hover {
        color: #ef3e36;
      }
    </style>
    <link rel="icon" type="image/x-icon" href=assets/logo.ico>
    <link href="../css/style.css" rel="stylesheet">
    <link href="../css/responsivity.css" rel="stylesheet">  
    <script src="../search/main.js"></script>
    <script src="https://kit.fontawesome.com/b57355f8ac.js" crossorigin="anonymous"></script>
    <script id="altmetric-embed-js" src="https://d1bxh8uas1mnw7.cloudfront.net/assets/altmetric_badges-e7ba41a192efc3e63f5d48f8a1916dec4b1b49c01075bc7b39481408957b3b28.js"></script>
    <link id="altmetric-embed-css" rel="stylesheet" type="text/css" href="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed-59614f5c46b49b21eeef3bb28c4fb38d1e7069e8d014752fcb66e84942556802.css">
    <script>
      function on_share() {
        navigator.share({
          url: document.URL,
          title: "Technical Guide -Refurboard",
        });
      }
    </script>
</head>

<body id="background">
  <div id="background-gradient"></div>
  <content id="content">
  
<a id="share-btn" onclick="on_share()">
  <i class="fa fa-share-alt" alt="ðŸ”—"></i>
</a>

  
  <header id="article-header">
    <a href=.. id="return-home">
        <i class="fa fa-arrow-left" alt="â‡¦"></i> Home
    </a>
    <h1 id="title">Technical Guide</h1>
</header>
  
  <main id="page">
    <nav class="vertical" id="toc">

<ul>

<li class="nav-item">
<a href="#technical-documentation">Technical Documentation</a>
    
    <ul>
    
    
    <li class="nav-subitem">
    <a href="#software-stack">Software Stack</a>
    </li>
    
    
    
    <li class="nav-subitem">
    <a href="#architecture-overview">Architecture Overview</a>
    </li>
    
    
    
    <li class="nav-subitem">
    <a href="#dear-pygui-layout-columnar-ui">Dear PyGui Layout (Columnar UI)</a>
    </li>
    
    
    
    <li class="nav-subitem">
    <a href="#configuration-file">Configuration File</a>
    </li>
    
    
    
    <li class="nav-subitem">
    <a href="#installation-from-source">Installation from Source</a>
    </li>
    
    
    
    <li class="nav-subitem">
    <a href="#linux-pointer-control-waylandx11">Linux Pointer Control (Wayland/X11)</a>
    </li>
    
    
    
    <li class="nav-subitem">
    <a href="#testing-packaging">Testing &amp; Packaging</a>
    </li>
    
    
    
    <li class="nav-subitem">
    <a href="#advanced-troubleshooting">Advanced Troubleshooting</a>
    </li>
    
    
    
    <li class="nav-subitem">
    <a href="#contributing">Contributing</a>
    </li>
    
    
    </ul>
    
</li>

</ul>

</nav>
    <h1 id="technical-documentation">Technical Documentation</h1>
<p><a href="../">Home</a> | <a href="./">Technical Guide</a></p>
<p>This page covers the technical details for developers and IT administrators who want to understand Refurboard's internals, contribute to the project, or troubleshoot advanced issues.</p>
<h2 id="software-stack">Software Stack</h2>
<ul>
<li><strong>Python 3.11+</strong> managed by Poetry.</li>
<li><strong>OpenCV + NumPy</strong> for capture, blob analysis, and homography math.</li>
<li><strong>Dear PyGui</strong> for the main control column (420 px wide, stacked widgets).</li>
<li><strong>Pointer drivers</strong>: ydotool on Linux/Wayland (needs uinput); pynput/XTest on X11; SendInput on Windows; Quartz CGEvent on macOS.</li>
<li><strong>PyInstaller</strong> for single-file binaries.</li>
</ul>
<h2 id="architecture-overview">Architecture Overview</h2>
<p>Refurboard uses OpenCV-based IR blob detection with adaptive brightness gating. The system:</p>
<ol>
<li>Captures frames from any UVC-compatible camera (USB webcam or phone-as-webcam).</li>
<li>Detects IR blobs above a learned intensity threshold.</li>
<li>Maps blob coordinates through a 3Ã—3 homography matrix to screen coordinates.</li>
<li>Drives the system cursor via platform-specific pointer backends.</li>
</ol>
<p>The Dear PyGui control surface is intentionally tall and narrow for lecterns and portrait displays. The fullscreen calibration viewport uses pure OpenCV (no nested toolkits, no window chrome) for consistent behavior across platforms.</p>
<h2 id="dear-pygui-layout-columnar-ui">Dear PyGui Layout (Columnar UI)</h2>
<p>The app window vertical stack contains:</p>
<ol>
<li><strong>Logo header</strong> - uses the PNG assets in <code>/assets</code> for brand consistency.</li>
<li><strong>Camera picker</strong> - dropdown listing USB/phone webcams plus a refresh button.</li>
<li><strong>Sensitivity sliders</strong> - IR gain and click hysteresis with safe defaults but adjustable live.</li>
<li><strong>Calibration button</strong> - launches the fullscreen OpenCV viewport on the active display.</li>
<li><strong>Accuracy summary</strong> - RMS reprojection error displayed after calibration.</li>
<li><strong>Live preview</strong> - shows the camera feed with detected IR blobs highlighted.</li>
</ol>
<h2 id="configuration-file">Configuration File</h2>
<ul>
<li>Stored via PlatformDirs (e.g., <code>~/.local/share/Refurboard/refurboard.config.json</code> on Linux).</li>
<li>Contains the active camera ID; detection knobs (sensitivity, hysteresis, smoothing, jitter deadzone <code>min_move_px</code>); and the latest calibration quadrilateral plus monitor name/index and origin.</li>
<li>Safe to edit between sessions; the UI writes whenever you tweak sliders or complete calibration.</li>
</ul>
<h2 id="installation-from-source">Installation from Source</h2>
<pre><code class="language-bash"># Clone repository
git clone https://github.com/kevinl95/Refurboard.git
cd Refurboard

# Install dependencies
poetry install

# Launch the control surface
poetry run refurboard
</code></pre>
<p>Poetry downloads all runtime dependencies (OpenCV, Dear PyGui, pynput, etc.) and exposes a console script named <code>refurboard</code>.</p>
<h2 id="linux-pointer-control-waylandx11">Linux Pointer Control (Wayland/X11)</h2>
<h3 id="x11">X11</h3>
<p>Works out of the box via pynput/XTest. No additional setup required.</p>
<h3 id="wayland">Wayland</h3>
<p>Install <code>ydotool</code> and ensure uinput access:</p>
<p><strong>1. Add user to input group:</strong></p>
<pre><code class="language-bash">sudo usermod -aG input $USER
# Log out and back in for this to take effect
</code></pre>
<p><strong>2. Create udev rule for uinput access:</strong></p>
<pre><code class="language-bash">sudo tee /etc/udev/rules.d/70-uinput.rules &gt;/dev/null &lt;&lt;'EOF'
KERNEL==&quot;uinput&quot;, MODE=&quot;0660&quot;, GROUP=&quot;input&quot;, TAG+=&quot;uaccess&quot;, OPTIONS+=&quot;static_node=uinput&quot;
EOF
sudo udevadm control --reload-rules
sudo udevadm trigger --subsystem-match=misc --attr-match=name=uinput
sudo modprobe uinput
</code></pre>
<p><strong>3. Run ydotoold as a user service:</strong></p>
<pre><code class="language-bash">mkdir -p ~/.config/systemd/user
cat &gt; ~/.config/systemd/user/ydotool.service &lt;&lt;'EOF'
[Unit]
Description=ydotoold (user)
After=graphical-session.target

[Service]
Type=simple
Environment=XDG_RUNTIME_DIR=/run/user/%U
ExecStart=/usr/bin/ydotoold --socket-path /run/user/%U/.ydotool_socket
Restart=on-failure

[Install]
WantedBy=default.target
EOF
systemctl --user daemon-reload
systemctl --user enable --now ydotool.service
</code></pre>
<p>Verify <code>/run/user/$(id -u)/.ydotool_socket</code> exists. Refurboard drives the cursor through this socket on Wayland.</p>
<h2 id="testing-packaging">Testing &amp; Packaging</h2>
<pre><code class="language-bash">poetry run pytest                      # run unit tests
poetry run pyinstaller --clean refurboard.spec  # build single-file binary
</code></pre>
<p>GitHub Actions run tests plus PyInstaller builds on Ubuntu, Windows, and macOS. The spec bundles OpenCV libs, logo assets, and Quartz modules on macOS.</p>
<h2 id="advanced-troubleshooting">Advanced Troubleshooting</h2>
<table>
<thead>
<tr>
<th>Symptom</th>
<th>Fix</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cursor wobbles</strong></td>
<td>Increase smoothing or <code>min_move_px</code> in config; reduce camera gain; ensure tripod stability.</td>
</tr>
<tr>
<td><strong>Clicks misfire</strong></td>
<td>Raise sensitivity or hysteresis so weak reflections keep the click gate open.</td>
</tr>
<tr>
<td><strong>Calibration error &gt; 10 px</strong></td>
<td>Re-run calibration after re-aiming the camera; ensure camera sees every corner and minimize bright IR reflections.</td>
</tr>
<tr>
<td><strong>Pointer on wrong monitor</strong></td>
<td>Re-run calibration on the intended display; the app remembers that monitor.</td>
</tr>
<tr>
<td><strong>Wayland: cursor does not move</strong></td>
<td>Ensure <code>ydotoold</code> user service is running and <code>/run/user/$(id -u)/.ydotool_socket</code> exists; add user to <code>input</code>, apply the udev rule for <code>/dev/uinput</code>, reload <code>uinput</code>.</td>
</tr>
</tbody>
</table>
<h2 id="contributing">Contributing</h2>
<p>Contributions are welcome! Please see the <a href="https://github.com/kevinl95/Refurboard">GitHub repository</a> for issues and pull requests.</p>
    <nav id="page-controls">
      <a href="#content" id="return-top">
        <i class="fa fa-arrow-up" alt="â‡§"></i> Return to top
      </a>
    </nav>
  </main>
  </content>
  <footer id="footer">
    

<p>Compiled from markdown using <a href="https://www.mkdocs.org/">MkDocs</a>. Theme is <a href="https://teparsons.github.io/mkdocs-landing/">Landing</a> by <a href="https://toddparsons.co.uk">Todd Parsons</a>.</p>












<a id=page-source href=https://github.com/kevinl95/Refurboard><i class="fa-brands fa-github"></i> Page source</a>



<script src="../search/main.js"></script>

  </footer>
</body>

</html>